


// ðŸ”· 'ë¡œê·¸ì¸ í•  ë•Œ ê²€ì¦' , 'ë¡œê·¸ì¸ ìœ ì§€ë˜ëŠ” ì‹œê°„ ê´€ë ¨' 
    
    // 'JWT í† í°' 
        // ì¡´ë§›íƒ± í† í°
        // ë¡œê·¸ì¸ì´ ìœ ì§€ë˜ê³  ìžˆëŠ”ì§€, ë§Œë£Œ ëœ ê±´ì§€
        // ì •ìƒì ì¸ í† í°ì¸ì§€ë„
        
        // JSON Web Token 
        // ì›¹ í‘œì¤€ìœ¼ë¡œ ë‘ ê°ì²´ì˜ json ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ, ì •ë³´ë¥¼ ì•ˆì •ì„± ìžˆê²Œ ì „ë‹¬. 

        // ì‚¬ìš©í•  ì •ë³´ë¥¼ ìžì²´ì ìœ¼ë¡œ ê°€ì§€ê³  ìžˆë‹¤. (ìš°ë¦¬ê°€ í•„ìš”í•œ ìœ ì € ì •ë³´ ê°™ì€)
        // JWT ë¡œ ë°œê¸‰í•œ í† í°ì€ ê¸°ë³¸ì •ë³´ (ìœ ì €ì˜ í”„ë¡œí•„) 
        // ë¯¼ê°í•œ ì •ë³´ëŠ” ì•ˆ ëœë‹¤. 

        // í† í°ì´ ì •ìƒì¸ì§€ ê²€ì¦! í•´ì•¼ í•¨. 
        // ì •ìƒì¸ì§€ëŠ” 'ì„œëª…' ìœ¼ë¡œ ê²€ì‚¬ í•œë‹¤. (signature)

        // ì£¼ë¡œ, ë¡œê·¸ì¸ì´ ì •ìƒì ì¸ì§€ íšŒì› ì¸ì¦ ê¶Œí•œì—ì„œ ì‚¬ìš©í•œë‹¤. 

        // JWTì€ ìœ ì €ê°€ ë¡œê·¸ì¸í•˜ë©´, ì„œë²„ì—ì„œ ìœ ì €ì˜ ì •ë³´ë¥¼ ê°€ì§€ê³ , 
            // ì •ìƒì ì¸ ë£¨íŠ¸ë¡œ ë¡œê·¸ì¸ì„ ìš”ì²­í•œ ìœ ì €ë©´, 'í† í°' ì„ ë°œê¸‰í•´ì„œ ì „ë‹¬í•œë‹¤. (ì˜í™”í‘œ) 
            // ìœ ì €ê°€ ì„œë²„ì— ìš”ì²­ì„ í•  ë•Œ, JWT í† í°ì„ í¬í•¨í•´ì„œ ìš”ì²­ì„ í•˜ë©´, ì„œë²„ê°€ ìš”ì²­ì„ ë°›ê³ , í† í°ì´ ì©ì€ í† í°ì¸ì§€ ê²€ì‚¬í•´ì„œ,
            // ì°©í•œ í† í°ì´ë©´, ìœ ì €ê°€ ìš”ì²­í•œ ìž‘ì—…ì„ ì²˜ë¦¬í•´ì£¼ê³ , ì‘ë‹µí•´ì¤€ë‹¤. 
            // EX) ì˜í™”í‘œë¥¼ ì‚¬ë©´, ì˜í™” ì‹œê°„ì´ ëª‡ì‹œ ê¹Œì§€, ì¸ì§€ 'ìœ íš¨ ê¸°ê°„' ì´ ìžˆë‹¤. 'ëª‡ì‹œ ê¹Œì§€ ì™€~' ì´ëŸ°ê±° 
            // EX) ê°–ê³  ì˜¤ë©´ > "ì‹œê°„ ì§€ë‚¬ì–´ìš”~ ì•„ë‹ˆë©´, ê´œì°®ë„¤ìš”~" ë¼ëŠ” ê±°
            // í† í°ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” 'ë¡œê·¸ì¸ ìœ ì§€ ì‹œí‚¬ ë•Œ, í† í° ì©ì€ì§€ ì—¬ë¶€ë¥¼ íŒë‹¨í•´ì„œ > ë¡œê·¸ì¸ ìœ ì§€ë¥¼ ì²˜ë¦¬' ê°€ ì¤‘ìš” â­â­â­â­â­â­ 

        
        // JWT ë¥¼ ì“°ëŠ” ì´ìœ ëŠ”, ì•ˆì •ì„± ìžˆê²Œ ì •ë³´ë¥¼ ì „ë‹¬í•´ì„œ, ìš”ì²­ì„ í•  ìˆ˜ ìžˆë‹¤. 
            // ì•„ë¬´ë‚˜ ì“°ë©´ ì•ˆ ë˜ë‹ˆê¹Œ, 'í•´ì‹± ìž‘ì—…' 'ì•”í˜¸í™”' 'ì¸ì½”ë”©' ìž‘ì—…ì„ í•œë‹¤. 
            // JWT ë¥¼ ìƒì„±í•˜ë©´, ì‚¬ìš©í•  ëª¨ë“ˆì´ 'ì¸ì½”ë”©' 'í•´ì‹±ìž‘ì—…' ì„ í•´ì¤€ë‹¤. 

            // HMAC : í•´ì‹± ê¸°ë²•ì„ ì ìš©í•´ì„œ, ë©”ì‹œì§€ì˜ ìœ„ë³€ì¡°ë¥¼ ë°©ì§€í•˜ëŠ” ê¸°ë²• 
            // SHA256 : í•´ì‹± ì•Œê³ ë¦¬ì¦˜ìž„, ì „ë‹¬í•œ ë¬¸ìžì—´ì„ 'ì•”í˜¸í™”' ì‹œí‚´. | í˜„ìž¬ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ ì¤‘ì—ì„œ ê°€ìž¥ ë§Žì´ ì‚¬ìš©í•¨
                // ìž„ì˜ì˜ ê¸¸ì´ ë©”ì‹œì§€ë¥¼ 256 ë¹„íŠ¸ì˜ ì¶•ì•½ëœ ë©”ì‹œì§€ë¡œ, ë§Œë“¤ì–´ ë‚´ëŠ” í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ 
                // ë¸”ë¡ì²´ì¸ì—ì„œ í•œë²ˆ ë” ë‚˜ì˜´!

    // ðŸ”· JWT êµ¬ì¡° 
        
    // let header = {
    //     alg : "SHA256", // í—¤ë” ì•ˆì— ì•Œê³ ë¦¬ì¦˜ ìžˆìŒ. ì‚¬ìš©í•˜ëŠ” í•´ì‹± ì•Œê³ ë¦¬ì¦˜
    //     type : "JWT",   // í† í°ì˜ íƒ€ìž… 
    // } 

    // let payload = {
    //     // í† í°ì˜ ì´ë¦„, ì œëª©
    //         sub : "546534", 
    //     // ìœ ì €ì˜ ì´ë¦„ (ìœ ì € í”„ë¡œí•„) 
    //         name : "fldsakdjf", 
    //     // í† í° ë°œê¸‰ëœ ì‹œê°„ (ë°œê¸‰ëœì§€ ì–¼ë§ˆë‚˜ ì§€ë‚¬ëŠ”ì§€)
    //         lat : "123123123"   // í† í°ì´ ë°œê¸‰ë˜ê³  ì‹œê°„ì´ ì–¼ë§ˆë‚˜ ì§€ë‚˜ëŠ”ì§€ ë‹´ì•„ì„œ ì „ë‹¬ 
    // }

    // ì´ 2ê°œì˜ ê°ì²´ë¥¼ ì´ìš©í•´ì„œ 'ì„œëª…' ì„ ë§Œë“ ë‹¤. 

    // ë¹„ë°€í‚¤ ìƒì„±
        // let signature = HMACSHA256(BASE64URL(header)) + BASE64URL(payload);
            // header ì™€ payload ë‚´ìš©ì„ base 64 ë¡œ ë³€ê²½í•˜ê³  
            // sha256 ì•Œê³ ë¦¬ì¦˜ì„ ì´ìš©í•´ì„œ 
            // ì„œëª… ìœ¼ë¡œ ë§Œë“¦. 
            // ê·¸ëž˜ì„œ ë¹„ë°€í‚¤ë¡œ ìƒì„± 
            // ì¦‰, ê°’ì„ í•©ì³ì„œ ë¹„ë°€í‚¤ë¡œ í•´ì‹±

            // header : íƒ€ìž…ê³¼ ì•Œê³ ë¦¬ì¦˜ì˜ ì •ë³´ë¥¼ ê°–ê³  ìžˆìŒ. 
            // payload : ìœ ì €ì˜ ì •ë³´, ë§Œë£Œ ê¸°ê°„ì´ í¬í•¨ëœ ê°ì²´ë¥¼ ê°–ê³  ìžˆë‹¤. 
            // signature : header ì™€ payload ë¥¼ ì¸ì½”ë”©í•˜ê³ , í•©ì³ì„œ, í•´ì‹±(HMACSHA256)í•´ì„œ, 'ë¹„ë°€í‚¤' ë¡œ ë§Œë“ ë‹¤.

    // ë‹¤ë¥¸ í† í° (ë‹¤ìŒ ìˆ˜ì—… ë•Œ í•  ê²ƒ)
        // refresh í† í° : ì ‘ì†ì— ê´€í•œ ì—­í• ì„ í•´ì£¼ëŠ” í† í°ì„ ë°œê¸‰í•´ ì£¼ëŠ” í† í° 
        // access í† í° : ì ‘ì†ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í† í° 


// ðŸ”· ì˜¤ëŠ˜ ì‚¬ìš©í•  ëª¨ë“ˆ 
    // express, jsonwebtoken, dotenv, ejs ë„ ì„¤ì¹˜ í•´ì•¼ í•¨ 

    // dotenv ì–´í”Œë¦¬ì¼€ì´ì…˜ ë§Œë“¤ë©´ì„œ, ì„¤ì •ê°’ë“¤ì„ ì´ê³³ì— ìž‘ì„±í•¨ 
        // ì´ìœ ëŠ”?
            // 'ë³´ì•ˆ' 
            // ì¦‰, ë¯¼ê°í•œ ì •ë³´ë¥¼ íƒˆì·¨ ë‹¹í•˜ì§€ ì•Šê¸° ìœ„í•´, .env íŒŒì¼ì— ìž‘ì„±í•´ ë‘”ë‹¤.
            // íŒ¨ìŠ¤ì›Œë“œë¥¼ ì†ŒìŠ¤ì½”ë“œì— ìž‘ì„±í•˜ë©´, í•´í‚¹ë  ìˆ˜ ìžˆìœ¼ë‹ˆê¹Œ. 
        // ë¹„ë°€í‚¤, ì•”í˜¸, API í† í° ë“±ë“±ì„ ì €ìž¥í•´ ë†“ëŠ”ë‹¤.
        // 

    // express ì„¤ì¹˜
        const express = require("express");

    // jwp ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸° 
        const jwt = require("jsonwebtoken")

    // dotenv ëª¨ë“ˆ ê°€ì ¸ì˜¤ë©´ì„œ, config ë©”ì†Œë“œ ì‹¤í–‰
        const dot = require("dotenv").config();
            // [í•´ì„]
                // config ì‹¤í–‰í•˜ë©´ > env íŒŒì¼ì„ ì½ì–´ì„œ ì ìš©
                // env íŒŒì¼ì€ 'ë£¨íŠ¸ê²½ë¡œ, ìµœìƒë‹¨!' ì— ë§Œë“¤ê¸° 

            // .env íŒŒì¼ ë§Œë“  ì´ìœ  
                // jwt í† í°ì„ ë§Œë“¤ ê²ƒ ìž„. 
                // ì´ë•Œ, ë¹„ë°€í‚¤ë¥¼ ê°€ì§€ê³ , í† í°ì„ ë§Œë“¤ì–´ì„œ, ì•”í˜¸í™”, ì‹œí‚¬ ì˜ˆì •. 
                // ì´ë•Œ, 'ë¹„ë°€í‚¤' ëŠ” íƒˆì·¨ ë˜ë©´ ì•ˆ ë¼ 
                // so, env íŒŒì¼ì—, 'ë¹„ë°€í‚¤' ë¥¼ ë„£ì„ ì˜ˆì •. 
        // í‚¤ ê°€ì ¸ì˜¤ê¸° 
        const KEY = process.env.KEY;
            // process.env ê°ì²´ì—, ìš°ë¦¬ê°€ env íŒŒì¼ì— ì„¤ì •í•œ ì´ë¦„ìœ¼ë¡œ í‚¤ê°’ì´ ë“¤ì–´ìžˆë‹¤. 

    // path
        const path = require("path")


// ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ë„£ì–´ì£¼ê¸°
    const app = express();



// ðŸ”·ë¡œê·¸ì¸ í•˜ë©´, í† í°ì„ ë§Œë“¤ì–´ì£¼ëŠ” íŽ˜ì´ì§€ ë§Œë“¤ê¸°

    // view ì—”ì§„ íŒŒì¼ ê²½ë¡œ   
        app.set("views" , path.join(__dirname, "page"));
            // ì´ê²Œ view ì—”ì§„ íŒŒì¼ ê²½ë¡œ, ë¼ëŠ” ê±¸ ì–´ë–»ê²Œ ì•Œì•„? ë‹¤ë¥¸ ê²ƒì˜ ê²½ë¡œ ì¼ ìˆ˜ë„ ìžˆìž–ì•„ â“â“â“â“â“
    // ì‚¬ìš©í•  view ì—”ì§„ì€ ejs 
        app.set("view engine" , "ejs")
    // ê¹Šì€ ê°ì²´ ì‚¬ìš© ì—¬ë¶€ì— ëŒ€í•œ ì„¤ì • , ê¹Šì€ ê°ì²´ ì‚¬ìš© ì•ˆ í•˜ë‹ˆê¹Œ, false, body ê°ì²´ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ
        app.use(express.urlencoded({extended : false}))

        app.get("/" , (req, res) => {
            res.render("main");
        })

        app.post("/login" , (req, res) => {
            // ë¡œê·¸ì¸ì„ í•˜ë©´, ì •ìƒì ìœ¼ë¡œ, í–ˆë‹¤ ê°€ì •í•˜ê³ , 
            // í† í°ì„ ë°œê¸‰!
            // ìœ ì € ì •ë³´ëŠ” ë³€ìˆ˜ë¡œ ë§Œë“¤ì–´ì£¼ìž! 

            const name = "user1"; // ì´ ì¹œêµ¬ê°€ ë¡œê·¸ì¸ í•¨. 
            const KEY = process.env.KEY;

            // sign ì´ë¼ëŠ” ë©”ì†Œë“œë¡œ JWT í† í°ì„ ìƒì„± 
            let token = jwt.sign({
                // íƒ€ìž…ì€ JWT
                type : "JWT", 
                // ìœ ì € ì´ë¦„ 
                name : name
            }, KEY, // ì´ KEY ë¥¼ ê°€ì§€ê³  ë³µí˜¸í™” ë¥¼ í•œë‹¤. 
            {
                // í† í°ì„ ìœ ì§€ì‹œí‚¬ ë§Œë£Œì‹œê°„, ìœ íš¨ì‹œê°„ 
                expiresIn : "5m",   // 5ë¶„ ìœ ì§€ 
                // í† í° ë°œê¸‰í•œ ì‚¬ëžŒ
                issuer : "user1"
            })
            res.send(JSON.stringify(token)); 

                // "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiSldUIiwibmFtZSI6InVzZXIxIiwiaWF0IjoxNjgzODU4NDk4LCJleHAiOjE2ODM4NTg3OTgsImlzcyI6InVzZXIxIn0.3oMh07izFiHmf74rCUklg0nByENmD53ocqNS49tPTf4"
                    // . ìœ¼ë¡œ êµ¬ë¶„ 
                    // "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9. : í—¤ë” 
                    // ".eyJ0eXBlIjoiSldUIiwibmFtZSI6InVzZXIxIiwiaWF0IjoxNjgzODU4NDk4LCJleHAiOjE2ODM4NTg3OTgsImlzcyI6InVzZXIxIn0 : íŽ˜ì´ë¡œë“œ
                    // .3oMh07izFiHmf74rCUklg0nByENmD53ocqNS49tPTf4" : ì„œëª…
                    // ì´ë ‡ê²Œ í† í°ì´ êµ¬ì„±ë¨ 

                // ë§¤ê°œë³€ìˆ˜
                    // ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ : header ê°ì²´ 
                    // ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ : ë¹„ë°€í‚¤
                    // ì„¸ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ : payload ê°’ì„ ë„˜ê¸¸ ê²ƒ ìž„. 


        })



// ðŸ”· ì„œë²„ ëŒ€ê¸° ìƒíƒœ ë§Œë“¤ê¸°
const PORT = 8050;
app.listen (PORT, () => {
    console.log("ë“£ê³  ìžˆì–´ìš”~")
});







